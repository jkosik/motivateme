---
# Ansible inventory for MotivateMe K3s deployment
# Compatible with k3s-ansible collection: https://github.com/k3s-io/k3s-ansible
# Usage: ansible-playbook -i inventory/hosts.yml playbook.yml

all:
  children:
    # K3s cluster definition (required by k3s-ansible)
    k3s_cluster:
      children:
        # Server nodes (control plane + etcd)
        server:
          hosts:
            motivateme:
              ansible_host: motivateme.ink
              ansible_user: root
              ansible_ssh_private_key_file: /data/access/hetzner

        # Agent nodes (workers) - empty for single-node setup
        agent:
          hosts: {}

      vars:
        # k3s-ansible collection variables
        k3s_version: v1.31.4+k3s1  # Latest stable as of 2025
        k3s_become: true
        api_endpoint: 127.0.0.1
        api_port: 6443

        # Security: API listens on all interfaces for pod access, UFW blocks external
        # Note: Pods need to access API via service IP (10.43.0.1)
        extra_server_args: >-
          --tls-san={{ ansible_default_ipv4.address }}
          --tls-san={{ ansible_hostname }}
          --disable-cloud-controller
          --write-kubeconfig-mode=644

        # Traefik ingress controller (enabled by default)
        # To disable: add "--disable=traefik" to extra_server_args

    # Hardening group (custom role for security)
    hardening:
      hosts:
        motivateme:

  vars:
    # Global variables
    ansible_python_interpreter: /usr/bin/python3
    target_hostname: motivateme.ink

    # Security: Disable IPv6 completely (set to true if you don't need IPv6)
    disable_ipv6: true  # IPv6 disabled for maximum security

