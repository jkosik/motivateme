<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MotivateMe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt&family=Rubik:wght@500;700&display=swap" rel="stylesheet">
  <script type="module" src="./app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      min-height: 100vh;
      display: flex;
      line-height: 1.6;
    }

    .page-wrapper {
      display: flex;
      width: 100%;
      min-height: 100vh;
      transition: margin-right 0.3s ease;
    }

    .page-wrapper.help-open {
      margin-right: 600px;
    }

    .main-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    .container {
      max-width: 480px;
      width: 100%;
    }

    .help-panel {
      position: fixed;
      right: -600px;
      top: 0;
      width: 600px;
      height: 100vh;
      background: #fff;
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
      overflow-y: auto;
      transition: right 0.3s ease;
      padding: 40px;
      font-size: 14px;
    }

    .help-panel.open {
      right: 0;
    }

    .help-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 28px;
      font-weight: 300;
      color: #666;
      cursor: pointer;
      background: none !important;
      border: none;
      padding: 0;
      width: auto;
      height: auto;
      line-height: normal;
      text-align: center;
      outline: none;
      box-shadow: none;
      transition: none;
    }

    .help-close:hover,
    .help-close:focus,
    .help-close:active {
      background: none !important;
      color: #666;
      outline: none;
      box-shadow: none;
      transform: none;
    }

    .help-panel h3 {
      font-size: 18px;
      margin-top: 24px;
      margin-bottom: 12px;
      color: #000;
    }

    .help-panel h3:first-of-type {
      margin-top: 0;
    }

    .help-panel p {
      margin-bottom: 12px;
      line-height: 1.6;
      color: #333;
    }

    .help-panel ul {
      margin: 12px 0;
      padding-left: 24px;
    }

    .help-panel li {
      margin-bottom: 8px;
      line-height: 1.6;
      color: #333;
    }

    .claim-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      background: #fafafa;
    }

    .claim-card-header {
      font-weight: 600;
      margin-bottom: 8px;
      color: #000;
    }

    .claim-card-detail {
      font-size: 13px;
      margin: 4px 0;
      color: #555;
    }

    .claim-card-status {
      margin: 8px 0;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 13px;
      display: inline-block;
    }

    .status-locked {
      background: #fee;
      color: #c33;
    }

    .status-ready {
      background: #efe;
      color: #3c3;
    }

    .claim-btn {
      margin-top: 8px;
      padding: 12px 24px;
      background: #5848D5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-family: 'Rubik', sans-serif;
      font-weight: 700;
      transition: all 0.15s ease;
    }

    .claim-btn:hover {
      background: #4a3bb8;
    }

    .claim-btn:disabled {
      background: #9ca3af;
      color: #fff;
      cursor: not-allowed;
    }

    .proof-input {
      width: 100%;
      margin-top: 8px;
      padding: 8px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      font-size: 13px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }

    .logo {
      width: 180px;
      height: auto;
      margin: 0 auto 24px auto;
      display: block;
    }

    h1 {
      font-family: 'Rubik Dirt', cursive;
      font-size: 42px;
      font-weight: 400;
      margin-bottom: 16px;
      color: #000;
      letter-spacing: -0.5px;
      text-align: center;
    }

    .help-link {
      text-align: center;
      margin-bottom: 32px;
    }

    .help-link a {
      color: #666;
      text-decoration: none;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.15s ease;
    }

    .help-link a:hover {
      color: #000;
    }

    .section {
      margin-bottom: 32px;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 8px;
    }

    .info {
      color: #6b7280;
      font-size: 14px;
      flex-shrink: 0;
    }

    .info.connected {
      color: #10b981;
      font-weight: 500;
    }

    button {
      background: #000;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 15px;
      font-weight: 700;
      font-family: 'Rubik', sans-serif;
      cursor: pointer;
      transition: all 0.15s ease;
      min-width: 140px;
    }

    button:hover {
      background: #333;
    }

    #motivateBtn {
      background: #5848D5;
    }

    #motivateBtn:hover:not(:disabled) {
      background: #4a3bb8;
    }

    #motivateBtn:disabled {
      background: #9ca3af !important;
      color: #fff !important;
      cursor: not-allowed;
    }

    button:active {
      transform: scale(0.98);
    }

    button:disabled {
      background: #9ca3af;
      color: #fff;
      cursor: not-allowed;
    }

    .apply-btn {
      padding: 12px 16px;
      background: #0066ff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      min-width: auto;
    }

    .apply-btn:hover {
      background: #0052cc;
    }

    /* Toggle Switch */
    .toggle-container {
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .toggle-container input[type="checkbox"] {
      display: none;
    }

    .toggle-slider {
      position: relative;
      width: 44px;
      height: 24px;
      background: #e5e7eb;
      border-radius: 24px;
      transition: background 0.2s ease;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      top: 2px;
      left: 2px;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .toggle-container input[type="checkbox"]:checked + .toggle-slider {
      background: #0066ff;
    }

    .toggle-container input[type="checkbox"]:checked + .toggle-slider::before {
      transform: translateX(20px);
    }

    select {
      background: #fff;
      color: #1a1a1a;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%231a1a1a' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
      margin-bottom: 12px;
    }

    select:hover {
      border-color: #9ca3af;
    }

    select:focus {
      outline: none;
      border-color: #000;
    }

    input[type="number"],
    input[type="text"],
    input[type="date"],
    textarea {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 15px;
      transition: all 0.15s ease;
      width: 100%;
      margin-bottom: 12px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      outline: none;
      border-color: #000;
    }

    .contract-info {
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
      font-size: 13px;
      color: #9ca3af;
    }

    .contract-address {
      font-family: 'Courier New', monospace;
      word-break: break-all;
      margin-top: 4px;
      color: #667eea;
      text-decoration: none;
      transition: color 0.15s ease;
    }

    .contract-address:hover {
      color: #5568d3;
      text-decoration: underline;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 640px) {
      h1 {
        font-size: 28px;
      }
      .row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      button, select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper" id="pageWrapper">
    <div class="main-content">
      <div class="container">
        <img src="./logo.png" alt="MotivateMe Logo" class="logo">
        <h1>MotivateMe</h1>
        <div class="help-link">
          <a onclick="document.getElementById('claimsPanel').classList.remove('open'); document.getElementById('pageWrapper').classList.add('help-open'); document.getElementById('helpPanel').classList.add('open')">Help‚ùì</a>
          <span id="claimsPipe" style="margin: 0 8px; color: #ccc; display: none;">|</span>
          <a id="claimsLink" onclick="document.getElementById('helpPanel').classList.remove('open'); document.getElementById('pageWrapper').classList.add('help-open'); document.getElementById('claimsPanel').classList.add('open')" style="display: none;">My Claims üí∞</a>
        </div>

        <div class="section">
  <div class="row">
            <button id="connectBtn">Connect wallet</button>
            <div class="info" id="walletInfo">Not connected</div>
          </div>
  </div>

        <div class="section hidden" id="actionsSection">
          <select id="functionSelect">
            <option value="">Select Motivation</option>
            <option value="instantMotivation">Instant Motivation (immediate transfer)</option>
            <option value="timelockedMotivation">Time-locked Motivation (unlock on date)</option>
            <option value="proofOfActionMotivation">Proof-of-Action Motivation (recipient proves completion)</option>
          </select>
          <input type="text" id="recipientInput" placeholder="Recipient's address (0x...)" />
          <input type="number" id="ethAmountInput" placeholder="Amount of motivation in ETH (e.g., 0.001)" step="0.000001" min="0" />
          <input type="date" id="unlockDateInput" placeholder="Unlock date" style="display: none;" />
          <textarea id="messageInput" placeholder="Message/description (will be stored on blockchain)" rows="2" style="resize: vertical; min-height: 50px;"></textarea>
          <div class="info" id="functionInfo" style="text-align: center; margin-top: 12px; font-size: 14px;"></div>
          <button id="motivateBtn" style="margin-top: 12px;">Motivate</button>
  </div>

        <div class="contract-info hidden" id="contractInfo">
          <div style="margin-bottom: 12px;">
            <label class="toggle-container">
              <span style="font-size: 14px; color: #1a1a1a; margin-right: 8px;">Use custom contract</span>
              <input type="checkbox" id="customContractToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div id="customContractInput" class="hidden" style="margin-bottom: 12px;">
            <div style="display: flex; gap: 8px; align-items: center;">
              <input type="text" id="customContractAddr" placeholder="Enter contract address (0x...)" style="flex: 1; font-family: monospace; margin-bottom: 0;" />
              <button id="applyCustomContract" class="apply-btn">Apply</button>
            </div>
          </div>
          <div style="margin-bottom: 4px; font-size: 12px; color: #8c8c8c;">Active contract address:</div>
          <a id="contractAddr" class="contract-address" href="#" target="_blank" rel="noopener noreferrer"></a>
          <div id="walletBalance" class="hidden" style="margin-top: 8px;">
            <div style="font-size: 12px; color: #8c8c8c;">Wallet balance of native ETH (full precision)</div>
            <div id="balanceAmount" style="font-family: monospace; font-size: 12px; color: #8c8c8c;">‚Äî</div>
          </div>
        </div>

        <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; font-size: 11px; color: #999; text-align: center;">
          Independent educational project.
        </div>
      </div>
    </div>
  </div>

  <!-- Help Panel -->
  <div id="helpPanel" class="help-panel">
    <button class="help-close" onclick="document.getElementById('pageWrapper').classList.remove('help-open'); document.getElementById('helpPanel').classList.remove('open')">&times;</button>

    <h3>ü¶• What is <span style="font-family: 'Rubik Dirt', cursive;">MotivateMe</span>?</h3>
    <p>MotivateMe is a blockchain dApp (decentralized application) where you can challenge yourself or others by locking cryptocurrency as motivation.
      Money are released to the recipient only after the challenge is completed. Completion is defined in the Smart Contract.
      All transactions happen on the <strong><a href="https://inkonchain.com/" target="_blank">Ink network</a></strong>.</p>

    <h3>üí∞ Requirements for Challenger (locks money for the recipient)</h3>
    <ul>
      <li>EVM-compatible wallet (MetaMask, Kraken Wallet, etc.) as browser extension or mobile app.</li>
      <li><strong>Small fraction of ETH on Ink network</strong> in the wallet to pay for gas fees - equivalent of USD subcents is enough.</li>
      <li>To fund ETH to Ink network, you can use <a href="https://inkonchain.com/bridge" target="_blank">https://inkonchain.com/bridge</a> or any other bridge.</li>
      <li>Another easy way for funding is using Kraken Wallet and direct funding from Kraken Exchange account.</li>
    </ul>

    <h3>üéØ Requirements for Challenged (recipient of the money)</h3>
    <ul>
      <li>Ethereum-compatible address (0x...) generated by EVM-compatible wallet.</li>
      <li>To see the received funds, recipient must add Ink network to the wallet.</li>
      <li>Using Kraken wallet, funds can be easily transferred to Kraken exchange for further use or withdrawal.</li>
    </ul>

    <h3>‚ö†Ô∏è Important Notes</h3>
    <ul>
      <li>All transactions happen <strong>only on Ink network</strong>.</li>
      <li>Gas fees are paid in ETH on Ink network.</li>
    </ul>
  </div>

  <div id="claimsPanel" class="help-panel">
    <button class="help-close" onclick="document.getElementById('pageWrapper').classList.remove('help-open'); document.getElementById('claimsPanel').classList.remove('open')">&times;</button>

    <h3>üí∞ My Claimable Motivations</h3>
    <p id="claimsLoading" style="color: #666;">Loading your claimable motivations...</p>
    <div id="claimsList"></div>
  </div>

  <script type="module">
    // ---- CONFIG ----
    // Testnet Configuration (Ink Sepolia)
    const INK_SEPOLIA = {
      chainId: '0xba5ed',                     // 763373 in hex
      chainIdDecimal: 763373,
      chainName: 'Ink Sepolia',
      nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
      rpcUrls: ['https://rpc-gel-sepolia.inkonchain.com'],
      blockExplorerUrls: ['https://explorer-sepolia.inkonchain.com']
    };

    // Mainnet Configuration (Ink)
    const INK_MAINNET = {
      chainId: '0xdf11',                      // 57073 in hex
      chainIdDecimal: 57073,
      chainName: 'Ink',
      nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
      rpcUrls: ['https://rpc-gel.inkonchain.com'],
      blockExplorerUrls: ['https://explorer.inkonchain.com']
    };

    // Select to INK_MAINNET or INK_SEPOLIA. Testnet looks like not supported by Kraken Wallet for write operations.
    // const ACTIVE_NETWORK = INK_SEPOLIA;
    const ACTIVE_NETWORK = INK_MAINNET;

    // Multiple contract addresses - add more as needed
    const CONTRACT_ADDRESSES = {
      'default': {
        name: 'Default Contract',
        // address: '0x4fcC5C461B59ECC4786CDa6Ec270bA29Eb657FAF' // Counter contract
        // address: '0xDe3FabeD53AE4D7d90C385621EcdEdc795189ea3' // MotivateMe contract
        address: '0x6a5d3Cd30EfC58C8A864f6536D350521ADAd6f64' // MotivateMe Final
      },
      'alternative': {
        name: 'Alternative Contract',
        address: '0x0000000000000000000000000000000000000000' // Replace with actual address
      }
    };

    // Default contract address
    const CONTRACT_ADDRESS = CONTRACT_ADDRESSES['default'].address;

    // WalletConnect v2 Project ID from https://dashboard.reown.com
    const WALLETCONNECT_PROJECT_ID = 'd608436759f83467578a0fda722d7542';

    // Minimal ABI for Counter
    // MotivateMe.sol ABI
    const ABI = [
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "sender", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "recipient", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "indexed": false, "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "InstantMotivation",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "sender", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "recipient", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "index", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "unlockTimestamp", "type": "uint256" },
          { "indexed": false, "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "TimelockedMotivationCreated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "recipient", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "sender", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "index", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "TimelockedMotivationClaimed",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "sender", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "recipient", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "index", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "indexed": false, "internalType": "string", "name": "actionRequired", "type": "string" },
          { "indexed": false, "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "ProofOfActionMotivationCreated",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          { "indexed": true, "internalType": "address", "name": "recipient", "type": "address" },
          { "indexed": true, "internalType": "address", "name": "sender", "type": "address" },
          { "indexed": false, "internalType": "uint256", "name": "index", "type": "uint256" },
          { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "indexed": false, "internalType": "string", "name": "proofDescription", "type": "string" }
        ],
        "name": "ProofOfActionClaimed",
        "type": "event"
      },
      {
        "inputs": [
          { "internalType": "address payable", "name": "recipient", "type": "address" },
          { "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "instantMotivation",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "unlockTimestamp", "type": "uint256" },
          { "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "timelockedMotivation",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "uint256", "name": "index", "type": "uint256" }
        ],
        "name": "claimTimelockedMotivation",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "string", "name": "actionRequired", "type": "string" },
          { "internalType": "string", "name": "message", "type": "string" }
        ],
        "name": "proofOfActionMotivation",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "uint256", "name": "index", "type": "uint256" },
          { "internalType": "string", "name": "proofDescription", "type": "string" }
        ],
        "name": "claimProofOfAction",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "name": "timeLocks",
        "outputs": [
          { "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "internalType": "uint256", "name": "unlockTimestamp", "type": "uint256" },
          { "internalType": "bool", "name": "claimed", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "address", "name": "", "type": "address" },
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "name": "proofOfActions",
        "outputs": [
          { "internalType": "uint256", "name": "amount", "type": "uint256" },
          { "internalType": "string", "name": "actionRequired", "type": "string" },
          { "internalType": "bool", "name": "claimed", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "address", "name": "sender", "type": "address" }
        ],
        "name": "getTimelockedCount",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "address", "name": "sender", "type": "address" }
        ],
        "name": "getProofOfActionCount",
        "outputs": [
          { "internalType": "uint256", "name": "", "type": "uint256" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    // Initialize the app with configuration
    window.addEventListener('DOMContentLoaded', () => {
      if (window.initializeApp) {
        window.initializeApp({
          ACTIVE_NETWORK,
          CONTRACT_ADDRESS,
          CONTRACT_ADDRESSES,
          ABI,
          WALLETCONNECT_PROJECT_ID
        });
      }
    });
  </script>
</body>
</html>
